<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>InnoDB存储引擎总结 | Severin的博客</title>
  
  

  

  <meta name="HandheldFriendly" content="True" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css">
  

  
  <link rel="shortcut icon" type='image/x-icon' href="https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/favicon.ico">
  

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.11.26/css/style.css">

  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <h1 class='title'>Severin</h1>


  <div class="m_search">
    <form name="searchform" class="form u-search-form">
      <input type="text" class="input u-search-input" placeholder="" />
      <i class="icon fas fa-search fa-fw"></i>
    </form>
  </div>

<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-rss fa-fw'></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/friends/"
            
              rel="nofollow"
            
            
            id="friends">
            <i class='fas fa-link fa-fw'></i>&nbsp;友链
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          Severin的博客
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-grin fa-fw'></i>&nbsp;示例
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="categories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="tags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/archives/"
                  
                    rel="nofollow"
                  
                  
                  id="archives">
									<i class='fas fa-archive fa-fw'></i>&nbsp;归档
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<i class="icon fas fa-search fa-fw"></i>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a class="fas fa-search fa-fw" href='javascript:void(0)'></a></li>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/blog/archives/"
                
                  rel="nofollow"
                
                
                id="blogarchives">
								<i class='fas fa-archive fa-fw'></i>&nbsp;文章归档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/projects/"
                
                
                id="projects">
								<i class='fas fa-code-branch fa-fw'></i>&nbsp;开源项目
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/friends/"
                
                  rel="nofollow"
                
                
                id="friends">
								<i class='fas fa-link fa-fw'></i>&nbsp;我的友链
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://xaoxuu.com/wiki/material-x/"
                
                  rel="nofollow"
                
                
                id="https:xaoxuu.comwikimaterial-x">
								<i class='fas fa-book fa-fw'></i>&nbsp;主题文档
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
    


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/12/25/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/">
        InnoDB存储引擎总结
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    
      <a href="https://www.severin.xyz" rel="nofollow">
        
          <i class="fas fa-user" aria-hidden="true"></i>
        
        <p>Severin</p>
      </a>
    
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-12-25</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/mysql/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>数据库&nbsp;/&nbsp;mysql</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            
  
    <div class="new-meta-item wordcount">
      <a class='notlink'>
        <i class="fas fa-keyboard" aria-hidden="true"></i>
        <p>字数统计:</p>
        <p>7k字</p>
      </a>
    </div>
    <div class="new-meta-item readtime">
      <a class='notlink'>
        <i class="fas fa-hourglass-half" aria-hidden="true"></i>
        <p>阅读时长≈</p>
        <p>24分</p>
      </a>
    </div>
  

          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


    <section class="article typo">
      <div class="article-entry" itemprop="articleBody">
        <h4 id="1-MySQL体系结构和存储引擎"><a href="#1-MySQL体系结构和存储引擎" class="headerlink" title="1. MySQL体系结构和存储引擎"></a>1. MySQL体系结构和存储引擎</h4><p><strong>1. 什么是数据库，什么是数据库实例</strong></p>
<p>数据库是操作系统文件的集合。数据库实例时操作数据库文件的进程。</p>
<p><strong>2. MySQL的线程架构</strong></p>
<p>MySQL时单进程多线程架构的数据库</p>
<p><strong>3. MySQL由哪几部分组成</strong></p>
<p>连接池组件，管理服务和工具组件，SQL接口组件，查询分析器组件，优化器组件，缓冲组件，插件式存储引擎，物理文件组成。</p>
<p><img src="https://severinblog-1257009269.cos.ap-guangzhou.myqcloud.com/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/image-202001302029.jpg" alt="img"></p>
<p><strong>4. MySQL与其他数据库的区别</strong></p>
<p>拥有插件式的表存储引擎（存储引擎是基于表的不是基于数据库的）</p>
<p><strong>5. 有哪些存储引擎，各自的特点是什么</strong></p>
<ul>
<li><p>InnoDB</p>
<p>行锁设计，支持外键和事务，支持一致性非锁定读，支持多版本并发控制，实现了SQL标准的四种隔离级别，提供插入缓冲，二次写，自适应哈希索引和预读等功能。</p>
</li>
<li><p>MyISAM</p>
<p>表锁设计，不支持事务，支持全文索引，适合OLAP应用</p>
</li>
<li><p>NDB</p>
<p>NDB是一个集群存储引擎，索数据全部方内存中</p>
</li>
<li><p>Memory</p>
<p>将表中的数据全部放在内存中，如果数据库重启或者发生崩溃，数据都将小时，非常适合临时数据的临时表，默认使用哈希索引</p>
</li>
<li><p>Archive存储引擎</p>
<p>只支持插入和查询操作，支持行压缩存储，压缩比一般可以达到1：10，使用行锁来实现插入，适合存储日志信息</p>
</li>
<li><p>Federated存储引擎</p>
<p>不存放数据，类似一个网关，指向远程的MYSQL数据库服务器</p>
</li>
<li><p>Maria存储引擎</p>
<p>用来替代MyISAM存储引擎，缓存数据和索引文件，行锁设计，提供MVCC功能，支持事务</p>
</li>
</ul>
<p><strong>6. InnoDB存储引擎与MyISAM存储引擎的对比</strong></p>
<ol>
<li>InnoDB支持事务；MyISAM不支持事务。</li>
<li>InnoDB支持外键；MyISAM不支持外键。</li>
<li>InnoDB锁的粒度是行锁；MyISAM锁的粒度是表锁。</li>
<li>InnoDB把数据和索引存在一起；MyISAM把表分为三个文件：表结构(.frm)、表内容(MYD)、表索引(MYI)。</li>
<li>InnoDB不保存表的具体行数，需要通过扫描表来获取有多少行；MyISAM保存表的具体行数。</li>
<li>InnoDB删除表中数据时是一行一行的删除；MyISAM删除表时是先<code>drop</code>表，然后重建表。</li>
<li>InnoDB可跨平台拷贝直接使用；MyISAM很难跨平台直接使用。</li>
<li>InnoDB表格很难压缩；MyISAM表格可以被压缩。</li>
<li>InnoDB中必须包含只有该字段的索引；MyISAM表中可以和其他字段一起建立联合索引。</li>
</ol>
<p><strong>7. 如何查看数据库支持哪些存储引擎</strong></p>
<p><code>show engine</code></p>
<p><strong>8. 连接MySQL的方式有哪些</strong></p>
<ol>
<li>TCP/IP</li>
<li>命名管道和共享内存（windows）</li>
<li>Unix域套接字（xxx.socket）</li>
</ol>
<hr>
<h4 id="2-InnoDB存储引擎"><a href="#2-InnoDB存储引擎" class="headerlink" title="2. InnoDB存储引擎"></a>2. InnoDB存储引擎</h4><p><strong>1. 有哪些InnoDB版本</strong></p>
<table>
<thead>
<tr>
<th>版本</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>老版本InnoDB</td>
<td>支持事务，行锁设计，MVCC</td>
</tr>
<tr>
<td>InnoDB 1.0.x</td>
<td>增加了compress和dynamic页格式</td>
</tr>
<tr>
<td>InnoDB 1.1.x</td>
<td>增加了Linux AIO，多回滚段</td>
</tr>
<tr>
<td>InnoDB 1.2.x</td>
<td>增加了全文索引支持，在线索引添加</td>
</tr>
</tbody></table>
<p><strong>2. InnoDB存储引擎的体系结构</strong></p>
<p>由<code>内存池</code>和<code>后台线程</code>组成</p>
<p><img src="https://severinblog-1257009269.cos.ap-guangzhou.myqcloud.com/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/image-20200116093058928.png" alt="image-20200116093058927"></p>
<p><strong>3. 由哪些后台线程，作用是什么</strong></p>
<ul>
<li><p>Master Thread</p>
<p>负责将缓冲池中的数据异步刷新到磁盘，保证数据的一致性，包括脏页的刷新、合并插入缓冲、undo页的回收等。</p>
</li>
<li><p>IO Thread</p>
<p>处理异步IO请求的回调，有四种IO Threa，包括write、read、insert buffer和log IO Thread</p>
</li>
<li><p>Purge Thread</p>
<p>事务提交后，undo页就不需要了，Purge Thread用来回收已分配的undo页。</p>
</li>
<li><p>Page Cleaner Thread</p>
<p>进行脏页的刷新（这个功能是从Master Thread中抽出来的）</p>
</li>
</ul>
<p><strong>4. 有哪些内存池，都用来存放什么</strong></p>
<p><img src="https://severinblog-1257009269.cos.ap-guangzhou.myqcloud.com/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/image-20200116094402831.png" alt="image-20200116094402830"></p>
<ul>
<li><p>缓冲池</p>
<p>缓存数据页、索引页、插入缓冲、自适应哈希索引、锁信息和数据字典信息等。</p>
</li>
<li><p>重做日志缓冲池</p>
<p>缓存重做日志，首先将重做日志信息放入重做日志缓冲池，然后按一定的频率将其刷新到重做日志文件。</p>
</li>
<li><p>额外的内存缓冲池</p>
<p>对数据结构本身的内存分配使用额外的内存缓冲池管理</p>
</li>
</ul>
<p><strong>5. 缓冲池如何管理的</strong></p>
<p>由LRU列表、Free列表和Flush列表管理。</p>
<ul>
<li><p>LRU List</p>
<p>使用LRU（最近最少使用）算法管理页，使用频繁的页放在列表的前端，使用不频繁的页放在列表尾端，当内存不足时，首先释放LRU尾端的页。存储引擎中的LRU算法做了优化，插入新的页时不是放到前端，而是放在列表长度的5/8处，原因是，如何直接读取到的页放LRU的首部，对于某些操作需要访问表中的许多页，但这些页仅在本次操作中需要，并不是活跃的热点数据，这样会将热点数据页从LRU中刷出。</p>
</li>
<li><p>Free List</p>
<p>用来管理空闲的页，分配新的页时必须在这个列表中查找空闲页，如果没有就淘汰LRU列表中的页。</p>
</li>
<li><p>Flush List</p>
<p>管理脏页列表，注意脏页既存在于Flush列表又存在于LRU列表。</p>
</li>
</ul>
<p><strong>6. 什么是checkpoint</strong></p>
<p>checkpoint就是将脏页刷新到磁盘的一种机制。InnoDB存储引擎提交事务的时候，需要先写重做日志，然后把修改缓存中的页，这样即使数据库宕机也可以通过重做日志恢复，但是问题是重做日志的大小是有限制的，当重做日志文件不足时就可能导致数据丢失，另外如果只通过重做日志来恢复，则需要把所有的修改重做一遍时间太长了，因此引入了checkpoint技术，他可以在某些情况下将脏页刷新到磁盘，这样就不用担心重做日志文件大小不足的问题，并且恢复时checkpoint之前的重做日志不需要恢复，加快来了恢复的时间。</p>
<p><strong>7. checkpoint解决的问题</strong></p>
<ul>
<li>缩短数据库恢复的时间</li>
<li>缓冲池不够用时，将脏页刷新到磁盘</li>
<li>重做日志不可用时，将脏页刷新到磁盘</li>
</ul>
<p><strong>8. checkpoint的分类</strong></p>
<ul>
<li><p>Sharo Checkpoint</p>
<p>数据库关闭时将所有的脏页都刷新回磁盘，这是默认的工作方式。</p>
</li>
<li><p>Fuzzy Checkpoint</p>
<ul>
<li><p>Master Thread Checkpoint</p>
<p>隔一定时间间隔从缓冲池的脏页列表中刷新一定比列的页到磁盘（异步执行）</p>
</li>
<li><p>FLUSH_LRU_LIST Checkpoint</p>
<p>InnoDB要保证LRU列表中有差不多100个空闲页，如果不足会溢出LRU列表尾端的页，如果这些页中有脏页，会进行Checkpoint</p>
</li>
<li><p>Aysnc/Sync Flush Checkpoint</p>
<p>重做日志不可用时，这时需要强制将一些页刷新回磁盘，而此时脏页是从脏页列表中选取的。</p>
</li>
<li><p>Dirty Page too much Checkpoint</p>
<p>脏页数量太多会导致InnoDB存储引擎强制进行Checkpoint</p>
</li>
</ul>
</li>
</ul>
<p><strong>9. Master线程的工作方式</strong></p>
<p><strong>10. InnoDB有哪些关键特性</strong></p>
<ul>
<li>插入缓冲</li>
<li>两次写</li>
<li>自适应哈希索引</li>
<li>异步IO</li>
<li>刷新邻接页</li>
</ul>
<p><strong>11. 什么是插入缓冲</strong></p>
<p>对于自增长主键聚集索引的插入是顺序的不需要磁盘的随机读取，效率非常高，但是每张表只有一个聚集索引，其他的都是非聚集索引，对于非聚集索引的插入需要随机读取磁盘（离散的访问非聚集索引页），效率非常低，因此InnoDB存储引擎引入了插入缓冲来解决非聚集索引的插入性能问题：对于非聚集索引的插入或更新操作，不是每一次直接插入到索引页中，而是先判断插入的非聚集索引页是否在缓冲池中，若在，则直接插入，若不在则先放入一个插入缓冲对象中，然后再以一定的频率和情况进行插入缓冲和富非聚集多月叶子结点的合并操作，这样多个插入就合并到一个操作中，这就大大提高了对非聚集索引插入的性能问题。插入缓冲只适应与非唯一的非聚集索引，非唯一的原因是如果是唯一的，那么就要检查每一个页判断是否已存在，这样查找也是离散读取，插入缓冲就没有任何意义了。除了插入缓冲对于更新和删除也有类似的操作（他们的思想是在内存中进行操作，这是一种欺骗，但是之后会写入磁盘保证一致性）。</p>
<p><strong>11. 插入缓冲是如何实现的</strong></p>
<p>插入缓冲是B+树</p>
<p><strong>12. 什么是两次写</strong></p>
<p>InnoDB的页默认大小为16k，但是写入磁盘是按照磁盘的块为单位写，也就是说每次将数据页写会磁盘不是一个原子过程，可能写到一半的时候突然数据库宕机，这个问题叫做部分写失效，这个时候是无法通过redo日志来恢复的，因为redo日志是一个逻辑日日志，只记录了某个偏移量写什么记录，而这个页本身就已经损坏了，所有没有无法恢复。两次写是为了解决这个问题：在内存中有一个2m大小的两次写缓存，在进行脏页刷新的时候，首先会将脏页分两次复制到两次写缓存中，然后两次写缓存会刷新到磁盘中的共享表中，写入磁盘后再进行脏页的刷新，这样就算发生部分写失效，也可以找到该页的副本进行恢复。</p>
<p><strong>13. 什么是自适应哈希索引</strong></p>
<p>哈希是一种快速查询的方法，时间复杂度为O(1)；InnoDB存储引擎会监控各索引页的查询，如果发现建立哈希所有可以提高效率就坏建立哈希索引，这种哈希索引称为自适应哈希索引，他是不需要用户干预的。</p>
<p><strong>14. 什么是异步IO</strong></p>
<p>异步IO是指可以发出一个IO后不需要等待直接发起另一个IO，当所有IO请求发送出去，等待所有IO完成，这样可以提高IO效率。</p>
<p><strong>15. 什么是刷新邻接页</strong></p>
<p>当刷新一个脏页的时候，会检查这个脏页所在的区的其他页，如果也是脏页那么也会被刷新，这样的好处是可以通过AIO把多个IO合并成一个IO</p>
<hr>
<h4 id="3-文件"><a href="#3-文件" class="headerlink" title="3. 文件"></a>3. 文件</h4><p><strong>1. MySQL中有哪些文件</strong></p>
<p>有参数文件、日志文件、套接字文件、pid文件、表结构定义文件。</p>
<p><strong>2. MySQL数据库的参数类型有哪些</strong></p>
<p>有静态参数和动态参数，动态参数可以在数据库实例启动的情况下修改生效，静态参数必须关闭数据库实例修改后重启。</p>
<p><strong>3. 有哪些日志文件</strong></p>
<ul>
<li><p>错误日志</p>
<p>记录数据库在启动运行关闭过程中发生的错误信息。</p>
</li>
<li><p>二进制日志</p>
<p>记录了对数据库执行更改的所有操作，用于恢复，复制和审计的功能</p>
</li>
<li><p>慢查询日志</p>
<p>可以在数据库启动时设置一个慢查询阈值，所有查询时间大于这个阈值的sql语句都会被记录下来，通过慢查询日志可以定位到查询效率低的sql语句，方便排查问题。</p>
</li>
<li><p>查询日志</p>
<p>记录了所有的查询sql语句包括未执行的</p>
</li>
</ul>
<p><strong>4. InnoDB存储引擎有哪些独有的文件</strong></p>
<p>表空间文件和重做日志文件。</p>
<hr>
<h4 id="4-表"><a href="#4-表" class="headerlink" title="4. 表"></a>4. 表</h4><hr>
<h4 id="5-索引和算法"><a href="#5-索引和算法" class="headerlink" title="5. 索引和算法"></a>5. 索引和算法</h4><p><strong>1. 什么是索引</strong></p>
<p>索引是一种用于快速查询和排好序的数据结构</p>
<p><strong>2. 有哪些索引</strong></p>
<ul>
<li>从数据结构的角度<ul>
<li>B+树索引</li>
<li>hash索引</li>
<li>全文索引</li>
</ul>
</li>
<li>从物理存储角度<ul>
<li>聚集索引</li>
<li>非聚集索引</li>
</ul>
</li>
<li>从逻辑角度<ul>
<li>主键索引</li>
<li>单列索引</li>
<li>符合索引</li>
<li>唯一索引或非唯一索引</li>
<li>空间索引</li>
</ul>
</li>
</ul>
<p><strong>3. 什么是聚集索引，什么是非聚集索引</strong></p>
<p>聚集索引就是按照表的主键构造一棵B+树，叶节点存放了整张表的行记录数据，聚集索引的特性是数据是索引的一部分。非聚集索引指定了表中记录的逻辑顺序，但记录的物理顺序和索引的顺序不一致。聚集索引和非聚集索引都采用了B+树的结构，但非聚集索引的叶子层并不与实际的数据页相重叠，而采用叶子层包含一个指向表中的记录在数据页中的指针的方式。</p>
<p><strong>4. 聚集索引的优点和缺点</strong></p>
<p>聚集索引的优点是查询速度快，并且一点某个记录找到了其相邻的记录就在这条记录的前后，适合范围查找。缺点是对表进行修改的速度比较慢，这是为了保持表中的记录的物理顺序与索引的顺序一致，而把记录插入到数据页的相应位置，必须在数据页中进行数据重排， 降低了执行速度。</p>
<p><strong>5. 什么时候建聚集索引</strong></p>
<ol>
<li>此列包含有限数目的不同值；</li>
<li>查询的结果返回一个区间的值；</li>
<li>查询的结果返回某值相同的大量结果集。</li>
</ol>
<p><strong>6. 什么时候需要建立索引</strong></p>
<ol>
<li>主键自动建立唯一索引</li>
<li>频繁作为查询条件的字段应该创建索引</li>
<li>查询中与其他表管理的字段，外键关系建立索引</li>
<li>查询中排序的字段建立索引</li>
<li>查询中统计或者分组字段</li>
</ol>
<p><strong>7. 说明时候不需要建立索引</strong></p>
<ul>
<li>表记录太少</li>
<li>经常增删改的表</li>
<li>where条件用不到的字段</li>
<li>数据区分度比较小的字段、</li>
</ul>
<p><strong>8. 什么是B+树</strong></p>
<p>B+树是一个多路的平衡搜索树，B+树的结点由有序的元素和指针组成，指针的个数称为B+树的阶，B+树的特点是。</p>
<ul>
<li>根节点至少有一个元素，非根节点元素的范围为m/2&lt;=k&lt;=m-1</li>
<li>B+树有两种类型的节点，内部节点和叶子节点，内部节点不存储数据，只存储所有，数据都存储在叶子节点。</li>
<li>内部节点的key是按顺序存放的，元素的左子树的key都小于它，右子树的key都大于它，叶子结点中的记录也按照key的大小排列。</li>
<li>每个叶子结点都存有相邻叶子结点的指针，叶子结点本身依关键字的大小自小而大顺序链接。</li>
<li>父节点存有右孩子的第一个元素的索引。</li>
</ul>
<p><strong>9. 什么是B树</strong></p>
<p>B树也称B-树,它是一颗多路平衡查找树。二叉树我想大家都不陌生，其实，B树和后面讲到的B+树也是从最简单的二叉树变换而来的</p>
<ul>
<li><p>每个节点最多有m-1个<strong>关键字</strong>（可以存有的键值对）。</p>
</li>
<li><p>根节点最少可以只有1个<strong>关键字</strong>。</p>
</li>
<li><p>非根节点至少有m/2个<strong>关键字</strong>。</p>
</li>
<li><p>每个节点中的关键字都按照从小到大的顺序排列，每个关键字的左子树中的所有关键字都小于它，而右子树中的所有关键字都大于它。</p>
</li>
<li><p>所有叶子节点都位于同一层，或者说根节点到每个叶子节点的长度都相同。</p>
</li>
<li><p>每个节点都存有索引和数据，也就是对应的key和value。</p>
</li>
</ul>
<p><strong>10. 对比以下B+树比B树的优点（为什么MySQL采用B+树作为索引而不是B树）</strong></p>
<ul>
<li>单一节点存储的元素更多，使得查询的IO次数更少，所以也就使得它更适合做为数据库MySQL的底层数据结构了。</li>
<li>所有的查询都要查找到叶子节点，查询性能是稳定的，而B树，每个节点都可以查找到数据，所以不稳定。</li>
<li>所有的叶子节点形成了一个有序链表，更加便于查找。</li>
</ul>
<hr>
<h4 id="6-锁"><a href="#6-锁" class="headerlink" title="6. 锁"></a>6. 锁</h4><p><strong>1. 什么是锁，为什么要加锁</strong></p>
<p>锁是一种用来实现对共享资源安全访问的工具，当多个用户并发地存取数据时，在数据库中就可能会产生多个事务同时操作同一行数据的情况，若对并发操作不加控制就可能会读取和存储不正确的数据，破坏数据的一致性。</p>
<p><strong>2. InnoDB锁的类型</strong></p>
<p><img src="https://severinblog-1257009269.cos.ap-guangzhou.myqcloud.com/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/image-202001302035.jpg" alt="img"></p>
<ul>
<li><p>按照锁的粒度来分</p>
<ul>
<li><p>表锁</p>
<p>MySQL中锁定粒度最大的一种锁，对当前操作的整张表加锁，实现简单，资源消耗也比较少，加锁快，不会出现死锁。其锁定粒度最大，触发锁冲突的概率越高，并发度最低，MyISAM和InnoDB引擎都支持表级锁。</p>
</li>
<li><p>行锁</p>
<p>Mysql中锁定粒度最小的一种锁，只针对当前操作的行进行加锁。行级锁能大大减少数据库操作的冲突。其加锁粒度最小，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。</p>
</li>
<li><p>页锁</p>
</li>
</ul>
</li>
<li><p>按照锁算法来分</p>
<ul>
<li>Recodrd Lock</li>
<li>Gap Lock</li>
<li>Next-key Lock</li>
</ul>
</li>
<li><p>按照加锁机制来分</p>
<ul>
<li><p>乐观锁</p>
<p>乐观锁会“乐观地”假定大概率不会发生并发更新冲突，访问、处理数据过程中不加锁，只在更新数据时再根据版本号或时间戳判断是否有冲突，有则处理，无则提交事务；</p>
</li>
<li><p>悲观锁</p>
<p>悲观锁会“悲观地”假定大概率会发生并发更新冲突，访问、处理数据前就加排他锁，在整个数据处理过程中锁定数据，事务提交或回滚后才释放锁；</p>
</li>
</ul>
</li>
<li><p>按照兼容性来分</p>
<ul>
<li><p>共享锁</p>
<p>共享锁（<strong>Share Locks</strong>，简记为S锁）又称为<strong>读锁</strong>。其它事务可以并发地读取数据，可以再加共享锁，但任何事务都不能获取数据上的排它锁，直至已经释放所有共享锁。</p>
</li>
<li><p>排他锁</p>
<p>排它锁（<strong>Exclusive lock</strong>，简记为X锁）又称为<strong>写锁</strong>。若事务对数据对象加上了排它锁，则只允许该事务对数据对象进行读取和修改，其它事务不能再对数据对象加任何类型的锁，直到该事务释放对象上的排它锁。在更新操作(INSERT、UPDATE 或 DELETE)过程中始终应用排它锁。</p>
</li>
<li><p>意向锁</p>
<p>为了允许行锁和表锁共存，实现多粒度锁机制，InnoDB还有两种内部使用的意向锁（Intention Locks），这两种意向锁都是<strong>表锁</strong>。</p>
<ul>
<li><p>意向共享锁（IS）</p>
<p>表示事务准备给数据行加入共享锁，事务在给一个数据行加共享锁之前必须先取得该表的IS锁。</p>
</li>
<li><p>意向排它锁（IX）</p>
<p>表示事务准备给数据行加入排它锁，事务在给一个数据行加排它锁之前必须先取得该表的IX锁。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>3. 意向锁是什么，解决了什么问题</strong></p>
<p>MySQL中表锁和行锁共存，若不引入意向锁，该如何判断是否锁冲突呢？</p>
<p>假设事务T要对表T1加X锁，那就必须要判断T1表下每一个数据行是否加了S锁或者X锁。这样做的效率会非常低，需要对整个表进行遍历。在引入意向锁之后情况变得简单了。</p>
<p>假设事务T要对表T1加X锁，在这之前假设已经有事务A对数据行R加了S锁，那么此时表上已经有IS锁了（事务在给一个数据行加S锁之前必须先取得该表的IS锁）。由于X锁和IS锁冲突，所以事务T需要等待锁操作完成。这样就省去了遍历的操作，提高了冲突判断效率。</p>
<ul>
<li><p>意向锁是表锁，表示的是一种意向，仅仅表示事务正在读或写某一行记录，在真正加行锁时才会判断是否冲突。意向锁是InnoDB自动加的，不需要用户干预。</p>
</li>
<li><p>IX和IS是表锁，不会与行锁发生冲突，只会与表锁发生冲突。</p>
</li>
</ul>
<p><strong>4. 有哪些锁算法</strong></p>
<ul>
<li><p>Record Lock</p>
<p>记录锁，锁定一个行记录。</p>
<p>由于InnoDB特殊的索引机制，数据库操作使用主键索引时，InnoDB会锁住主键索引；使用非主键索引时，InnoDB会先锁住非主键索引，再锁定主键索引</p>
</li>
<li><p>Gap Lock</p>
<p>间隙锁，锁定一个区间，不包括记录本身</p>
</li>
<li><p>Next-Key Lock</p>
<p>记录锁+间隙锁（临键锁），锁定行记录和区间</p>
<p>InnoDB引擎采用Next-Key Lock来解决幻读问题。因为Next-Key Lock是锁住一个范围，所以就不会产生幻读问题。但是需要注意的是，InnoDB只在Repeatable Read隔离级别下使用该机制。</p>
</li>
</ul>
<hr>
<h4 id="7-事务"><a href="#7-事务" class="headerlink" title="7. 事务"></a>7. 事务</h4><p><strong>1. 事务有哪些特性</strong></p>
<ul>
<li><p>A（原子性）</p>
<p>原子性指的是一组操作不可分割要么全部执行成功要么全部执行失败，这有全部执行成功整个事务才算成功。</p>
</li>
<li><p>C（一致性）</p>
<p>事务将数据库从一种状态转变为下一种状态，事务开始和结束后，数据库的完整性约束没有被破坏。</p>
</li>
<li><p>I（隔离性）</p>
<p>事务与事务之间是相互分离的，一个事务提交前对其他事务是不可见的。</p>
</li>
<li><p>D（持久性）</p>
<p>事务一旦提交，其结果是永久性的，即使发生宕机数据库也能恢复。</p>
</li>
</ul>
<p><strong>2. 什么是事务</strong></p>
<p>事务就是访问或者更新数据库时的一个执行单元，这个执行单元中的所有操作，要么全部完成要么全部要失败</p>
<p><strong>3. 事务有哪些分类</strong></p>
<ul>
<li><p>扁平事务</p>
<p>所有操作都是在一个层次，操作是原子的，要么全部执行要么都回滚，不能回滚部分。</p>
</li>
<li><p>带保存点是扁平事务</p>
<p>允许事务回滚到当事务的一个较早的状态。（保存点）</p>
</li>
<li><p>链事务</p>
<p>在提交一个事务时，释放不需要的数据对象，将必要的处理上下文隐式的传给下一个要开始的事务。需要注意，提交事务操作和下一个事务操作将合并为一个<strong>原子操作</strong>，就是下一个事务可以看到上一个事务的结果。</p>
<p>链事务，就是指回滚时，只能恢复到最近一个保存点；而带有保存点的扁平事务则可以回滚到任意正确的保存点。</p>
<p>链事务在执行commit后就会释放当前事务所持有的所有锁，而带有保存点的扁平事务不会影响所持有的锁。</p>
</li>
<li><p>嵌套事务</p>
<p>事务与事务之间是有层次结构的</p>
</li>
<li><p>分布式事务</p>
<p>分布式环境下的事务</p>
</li>
</ul>
<p><strong>4. 事务的隔离级别</strong></p>
<ul>
<li>未提交读</li>
<li>已提交读</li>
<li>可重复读</li>
<li>可串行化</li>
</ul>
<p><strong>5. 事务是怎么实现的</strong></p>
<p>事务具有四种属性ACID，其中隔离性是通过锁来实现的，其他的三种属性是用过undo log和redo log来实现的。</p>
<p><strong>6. redo日志和undo日志的区别</strong></p>
<ul>
<li>redo日志用来保证事务的原子性和持久性，undo日志用来保证事务的一致性</li>
<li>redo日志和undo日志都可以视为一种恢复操作，redo日志恢复提交修改的页操作，undo日志用来回滚行记录到某个特定的版本</li>
<li>redo日志是物理日志，记录的是对页的物理修改，undo日志是逻辑日志，根据每行记录进行记录</li>
</ul>
<p><strong>7. 事务的ACID是怎么实现的</strong></p>
<p>事务的原子性是通过undo日志实现的、持久性是通过redo日志或二进制日志实现的、隔离性是通过锁机制实现的，一致性是通过保证原子性、持久性和隔离性，数据库本身和应用层面进行保证的。</p>
<p><a href="https://www.cnblogs.com/kismetv/p/10331633.html" target="_blank" rel="noopener">https://www.cnblogs.com/kismetv/p/10331633.html</a></p>
<p><strong>7. 详细介绍重做日志</strong></p>
<ul>
<li><p>什么是重做日志，重做日志有什么用</p>
<p>在事务提交前必须将该事务的所有日志写到重做日志文件中，重做日志文件由两部分组成，分别是redo日志和undo日志。</p>
</li>
<li><p>如何保证重做日志缓冲写入重做日志文件</p>
<p>在每次重做日志缓冲写入重做日志文件时都会调用fsync操作，将数据同步到磁盘，因此重做日志文件写入的效率与fsync操作调用的频率有关，允许用户控制重做日志刷新到磁盘的策略，主要由三种策略，事务提交时必须调用一次fsync；事务提交时不进行出写入重做日志操作，这个操作交给master thread完成，它会没1秒钟进行一次fsync操作；不进行fsync操作，由操作系统来决定什么时候同步。fsync执行的越频繁效率越低，但是越不容易丢失数据，</p>
</li>
<li><p>redo日志的作用</p>
<p>redo日志是来保证数据库的持久性的，当事务提交后会将修改写入缓存，如果发生了宕机可以通过redo日志来恢复。</p>
</li>
<li><p>undo日志的作用</p>
<p>事务在对数据库进行修改时，由于某种原因失败了，或者用户请求回滚，可以利用undo信息将数据回滚到修改之前的样子。</p>
<p>undo log属于逻辑日志，它记录的是sql执行相关的信息。当发生回滚时，InnoDB会根据undo log的内容做与之前相反的工作：对于每个insert，回滚时会执行delete；对于每个delete，回滚时会执行insert；对于每个update，回滚时会执行一个相反的update，把数据改回去。</p>
</li>
<li><p>为什么redo日志的写入会比刷新脏页的速度快</p>
<ul>
<li><p>刷脏是随机IO，因为每次修改的数据位置随机，但写redo log是追加操作，属于顺序IO。</p>
</li>
<li><p>刷脏是以数据页（Page）为单位的，MySQL默认页大小是16KB，一个Page上一个小修改都要整页写入；而redo log中只包含真正需要写入的部分，无效IO大大减少。</p>
</li>
</ul>
</li>
<li><p>redo日志和二进制日志的区别</p>
<ul>
<li>作用不同：redo log是用于crash recovery的，保证MySQL宕机也不会影响持久性；binlog是用于point-in-time recovery的，保证服务器可以基于时间点恢复数据，此外binlog还用于主从复制。</li>
<li>层次不同：redo log是InnoDB存储引擎实现的，而binlog是MySQL的服务器层(可以参考文章前面对MySQL逻辑架构的介绍)实现的，同时支持InnoDB和其他存储引擎。</li>
<li>内容不同：redo log是物理日志，内容基于磁盘的Page；binlog的内容是二进制的，根据binlog_format参数的不同，可能基于sql语句、基于数据本身或者二者的混合。</li>
<li>写入时机不同：binlog在事务提交时写入；redo log的写入时机相对多元</li>
</ul>
</li>
</ul>
<hr>
<h4 id="8-备份与恢复"><a href="#8-备份与恢复" class="headerlink" title="8. 备份与恢复"></a>8. 备份与恢复</h4><hr>
<p><em>参考：《MySQL技术内幕：InnoDB存储引擎》</em></p>
<p><strong>（未完待续）</strong></p>

      </div>
      
        <br>
        <center>感谢你对我的支持！<br><fancybox><img style="width:200px; height:200px; border-radius:50%;" src="https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/reward.png"/></fancybox></center>
      
      
        <br>
        


  <section class='meta' id="footer-meta">
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-01-30T20:34:02+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>updated at Jan 30, 2020</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>数据库</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/mysql/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>mysql</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/InnoDB/" rel="nofollow"><i class="fas fa-tag" aria-hidden="true"></i><p>InnoDB</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=https://www.severin.xyz/2019/12/25/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/&title=InnoDB存储引擎总结 | Severin的博客&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=https://www.severin.xyz/2019/12/25/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/&title=InnoDB存储引擎总结 | Severin的博客&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=https://www.severin.xyz/2019/12/25/InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E6%80%BB%E7%BB%93/&title=InnoDB存储引擎总结 | Severin的博客&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


      
      
          <div class="prev-next">
              
                  <section class="prev">
                      <span class="art-item-left">
                          <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;Previous</h6>
                          <h4>
                              <a href="/2019/12/26/MySQL%E8%B0%83%E4%BC%98%20Explain%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="prev" title="MySQL调优：Explain命令的使用">
                                
                                    MySQL调优：Explain命令的使用
                                
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 数据库</a> <a class="tag" href="/tags/mysql/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> mysql</a>
                              </h6>
                          
                      </span>
                  </section>
              
              
                  <section class="next">
                      <span class="art-item-right" aria-hidden="true">
                          <h6>Next&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                          <h4>
                              <a href="/2019/12/25/MySQL%E7%B4%A2%E5%BC%95%E6%80%BB%E7%BB%93/" rel="prev" title="MySQL索引总结">
                                  
                                      MySQL索引总结
                                  
                              </a>
                          </h4>
                          
                              
                              <h6 class="tags">
                                  <a class="tag" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> 数据库</a> <a class="tag" href="/tags/mysql/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> mysql</a> <a class="tag" href="/tags/MySQL%E7%B4%A2%E5%BC%95/"><i class="fas fa-tag fa-fw" aria-hidden="true"></i> MySQL索引</a>
                              </h6>
                          
                      </span>
                  </section>
              
          </div>
      
    </section>
  </article>



  <!-- 显示推荐文章和评论 -->



  <article class="post white-box comments">
    <section class="article typo">
      <h4><i class="fas fa-comments fa-fw" aria-hidden="true"></i>&nbsp;Comments</h4>
      
      
      
      
        <section id="comments">
          <div id="valine_container" class="valine_thread">
            <i class="fas fa-spinner fa-spin fa-fw"></i>
          </div>
        </section>
      
    </section>
  </article>






<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'InnoDB存储引擎总结',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
            
              
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;TOC</div>
  
    <!-- <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div> -->
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL体系结构和存储引擎"><span class="toc-text">1. MySQL体系结构和存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-InnoDB存储引擎"><span class="toc-text">2. InnoDB存储引擎</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-文件"><span class="toc-text">3. 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-表"><span class="toc-text">4. 表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-索引和算法"><span class="toc-text">5. 索引和算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-锁"><span class="toc-text">6. 锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-事务"><span class="toc-text">7. 事务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-备份与恢复"><span class="toc-text">8. 备份与恢复</span></a></li></ol>
    </div>
  </section>


            
          
        
          
          
        
          
          
        
      
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
    <div class="social-wrapper">
      
        
          <a href="/atom.xml"
            class="social fas fa-rss flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="mailto:807920489@qq.com"
            class="social fas fa-envelope flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
        
          <a href="https://github.com/mike-zeng"
            class="social fab fa-github flat-btn"
            target="_blank"
            rel="external nofollow noopener noreferrer">
          </a>
        
      
    </div>
  
  <br>
  <div><p>Blog content follows the <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener">Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0) License</a></p>
</div>
  <div>
    Use
    <a href="https://xaoxuu.com/wiki/material-x/" target="_blank" class="codename">Material X</a>
    as theme
    
      , 
      total visits
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      times
    
    . 
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>


      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

  <script>
    var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
    var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
    var ALGOLIA_API_KEY = "";
    var ALGOLIA_APP_ID = "";
    var ALGOLIA_INDEX_NAME = "";
    var AZURE_SERVICE_NAME = "";
    var AZURE_INDEX_NAME = "";
    var AZURE_QUERY_KEY = "";
    var BAIDU_API_ID = "";
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/"||"/";
    if(!ROOT.endsWith('/'))ROOT += '/';
  </script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          ["https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/background1.jpg", "https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/background2.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          ["https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/background1.jpg", "https://cdn.jsdelivr.net/gh/mike-zeng/zeng_cdn/blog/image/background2.jpg"],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  









  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
    
      
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis@1.0.6/js/volantis.min.js"></script>

    
  
  <script>
  var GUEST_INFO = ['nick','mail','link'];
  var guest_info = 'nick,mail,link'.split(',').filter(function(item){
    return GUEST_INFO.indexOf(item) > -1
  });
  var notify = 'true' == true;
  var verify = 'true' == true;
  var valine = new Valine();
  valine.init({
    el: '#valine_container',
    notify: notify,
    verify: verify,
    guest_info: guest_info,
    
    appId: "03wbpQpd8dcMWzsThoJ6MPQA-gzGzoHsz",
    appKey: "8KLQBX5uu2Reuus89jvRTphH",
    placeholder: "快来评论吧~",
    pageSize:'10',
    avatar:'retro',
    lang:'zh-cn',
    highlight:'true'
  })
  </script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.11/js/app.js"></script>



  
<script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.11/js/search.js"></script>





<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "Copied";
  let COPY_FAILURE = "Copy failed";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>Copy</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
</body>
</html>

---
title: MySQL调优：Explain命令的使用
sidebar: [grid, toc, tags] # 放置任何你想要显示的侧边栏部件
categories: [数据库, mysql]
date: 2019-12-26
tags:
- 数据库
- mysql
---

##### 1. Explain是什么有什么用

使用EXPLAIN关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是如何处理你的SQL语句的。分析你的查询语句或是表结构的性能瓶颈。

##### 2. Explain执行计划包含哪些字段,每个字段表示什么

1. **id**

   select查询的序列号,包含一组数字，表示查询中执行select子句或操作表的顺序

   - id相同的时候 ，执行顺序是由上至下
   - id不同的时候，id值越大的越先执行
   - id相同和不同同时存在的时候，id如果相同，可以认为是一组，从上往下顺序执行；
     在所有组中，id值越大，优先级越高，越先执行

2. **select_type**

   查询的类型，主要是用于区别普通查询、联合查询、子查询等的复杂查询。

   | 类型                 | 说明                                                         |
   | -------------------- | ------------------------------------------------------------ |
   | SIMPLE               | 简单的 select 查询,查询中不包含子查询或者UNION               |
   | PRIMARY              | 查询中若包含任何复杂的子部分，最外层查询则被标记为Primary    |
   | DERIVED              | 在FROM列表中包含的子查询被标记为DERIVED(衍生)MySQL会递归执行这些子查询, 把结果放在临时表里。 |
   | SUBQUERY             | 在SELECT或WHERE列表中包含了子查询                            |
   | DEPENDENT SUBQUERY   | 在SELECT或WHERE列表中包含了子查询,子查询基于外层             |
   | UNCACHEABLE SUBQUREY | 无法被缓存的子查询                                           |
   | UNION                | 若第二个SELECT出现在UNION之后，则被标记为UNION；若UNION包含在FROM子句的子查询中,外层SELECT将被标记为：DERIVED |
   | UNION RESULT         | 从UNION表获取结果的SELECT                                    |

3. **table**

   显示这一行的数据是关于哪张表的

4. **type**

   type显示的是访问类型，是较为重要的一个指标，结果值从最好到最坏依次是： 

   system > const > eq_ref > ref > fulltext > ref_or_null > index_merge > unique_subquery > index_subquery > range(尽量保证) > index > ALL 

   | 类型   | 说明                                                         |
   | ------ | ------------------------------------------------------------ |
   | system | 表只有一行记录（等于系统表），这是const类型的特列，平时不会出现，这个也可以忽略不计 |
   | const  | 表示通过索引一次就找到了,const用于比较primary key或者unique索引。因为只匹配一行数据，所以很快,如将主键置于where列表中，MySQL就能将该查询转换为一个常量 |
   | eq_ref | 唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见于主键或唯一索引扫描 |
   | ref    | 非唯一性索引扫描，返回匹配某个单独值的所有行,本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体 |
   | range  | 只检索给定范围的行,使用一个索引来选择行。key 列显示使用了哪个索引<br一般就是在你的where语句中出现了between、<、>、in等的查询。这种范围扫描索引扫描比全表扫描要好，因为它只需要开始于索引的某一点，而结束语另一点，不用扫描全部索引。 |
   | index  | Full Index Scan，index与ALL区别为index类型只遍历索引树。这通常比ALL快，因为索引文件通常比数据文件小。（也就是说虽然all和Index都是读全表，但index是从索引中读取的，而all是从硬盘中读的） |
   | all    | Full Table Scan，将遍历全表以找到匹配的行                    |

   至少要到达range级别

5. **possible_keys**

   显示可能应用在这张表中的索引，一个或多个。查询涉及到的字段上若存在索引，则该索引将被列出，但不一定被查询实际使用。（可能会用到）

6. **key**

   实际使用的索引。如果为NULL，则没有使用索引

7. **key_len**

   表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度。 

8. **ref**

   显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值

9. **rows**

   rows列显示MySQL认为它执行查询时必须检查的行数。

10. **extra**

    包含不适合在其他列中显示但十分重要的额外信息，文件排序/使用where信息/临时表等信息。